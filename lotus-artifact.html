<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotus Resume Generator - Artifact</title>

    <!-- Load docx library from CDN -->
    <script src="https://unpkg.com/docx@8.2.0/build/index.js"></script>

    <style>
        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            line-height: 1.6;
            color: #24292e;
            background-color: #ffffff;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #586069;
            margin-bottom: 24px;
            font-size: 16px;
        }

        .card {
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 24px;
            background: #f6f8fa;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            border-bottom: 1px solid #e1e4e8;
        }

        .tab {
            padding: 8px 16px;
            cursor: pointer;
            border: none;
            background: none;
            color: #586069;
            font-size: 14px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab:hover {
            color: #24292e;
        }

        .tab.active {
            color: #2ea44f;
            border-bottom-color: #2ea44f;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #24292e;
        }

        input[type="file"] {
            display: block;
            width: 100%;
            padding: 8px;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            background: white;
        }

        textarea {
            width: 100%;
            min-height: 300px;
            padding: 12px;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: vertical;
            background: white;
        }

        textarea:focus {
            outline: none;
            border-color: #0969da;
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1);
        }

        button {
            background-color: #2ea44f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #2c974b;
        }

        button:disabled {
            background-color: #94d3a2;
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: #f6f8fa;
            color: #24292e;
            border: 1px solid #d0d7de;
            padding: 6px 12px;
            font-size: 14px;
        }

        .btn-secondary:hover {
            background-color: #f3f4f6;
            border-color: #d0d7de;
        }

        #status {
            margin-top: 16px;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }

        #status.error {
            background-color: #fff5f5;
            color: #d73a49;
            border: 1px solid #d73a49;
            display: block;
        }

        #status.success {
            background-color: #f0fff4;
            color: #28a745;
            border: 1px solid #28a745;
            display: block;
        }

        .example-section {
            margin-top: 20px;
        }

        .example-toggle {
            color: #0969da;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 12px;
        }

        .example-toggle:hover {
            text-decoration: underline;
        }

        .example-content {
            display: none;
            background: white;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .example-content.show {
            display: block;
        }

        .example-content pre {
            margin: 0;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.5;
        }

        .button-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .info-text {
            color: #586069;
            font-size: 13px;
            margin-top: 8px;
        }

        .loading {
            display: inline-block;
            margin-left: 8px;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e1e4e8;
            color: #586069;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Lotus Resume Generator</h1>
    <p class="subtitle">Generate professionally formatted DOCX resumes from JSON - completely offline</p>

    <div class="card">
        <div class="tabs">
            <button class="tab active" data-tab="upload">Upload JSON File</button>
            <button class="tab" data-tab="paste">Paste JSON</button>
        </div>

        <!-- Upload Tab -->
        <div class="tab-content active" id="upload-content">
            <div class="form-group">
                <label for="jsonFile">Select Resume JSON File</label>
                <input type="file" id="jsonFile" accept=".json">
                <p class="info-text">Upload a JSON file containing your resume data</p>
            </div>
            <button id="generateFromFile">Generate Resume</button>
        </div>

        <!-- Paste Tab -->
        <div class="tab-content" id="paste-content">
            <div class="form-group">
                <label for="jsonText">Paste Resume JSON</label>
                <textarea id="jsonText" placeholder='{"name": "Your Name", "contact": {...}, "sections": [...]}'></textarea>
                <p class="info-text">Paste your resume JSON data directly</p>
            </div>
            <button id="generateFromText">Generate Resume</button>
        </div>

        <div id="status"></div>
    </div>

    <!-- Example JSON Section -->
    <div class="example-section">
        <a href="#" class="example-toggle" id="exampleToggle">ðŸ“‹ Show Example JSON</a>
        <div class="example-content" id="exampleContent">
            <div class="button-group" style="margin-bottom: 12px;">
                <button class="btn-secondary" id="copyExample">Copy Example</button>
                <button class="btn-secondary" id="useExample">Use This Example</button>
            </div>
            <pre id="exampleJson">{
  "name": "John Doe",
  "contact": {
    "items": ["john.doe@email.com", "(555) 123-4567", "linkedin.com/in/johndoe", "github.com/johndoe"]
  },
  "summary": {
    "heading": "PROFESSIONAL SUMMARY",
    "text": "Experienced software engineer with 5+ years of expertise in full-stack development, cloud architecture, and agile methodologies. Proven track record of delivering scalable applications and leading cross-functional teams."
  },
  "sections": [
    {
      "heading": "EXPERIENCE",
      "type": "experience",
      "content": [
        {
          "company": "Tech Corp",
          "dates": "Jan 2020 - Present",
          "title": "Senior Software Engineer",
          "location": "San Francisco, CA",
          "bullets": [
            "Led development of microservices architecture serving 10M+ users, improving system reliability by 40%",
            "Mentored team of 5 junior developers, implementing code review practices and reducing bug rate by 35%",
            "Architected CI/CD pipeline using Jenkins and Docker, reducing deployment time from 2 hours to 15 minutes"
          ]
        },
        {
          "company": "StartupXYZ",
          "dates": "Jun 2018 - Dec 2019",
          "title": "Full Stack Developer",
          "location": "Austin, TX",
          "bullets": [
            "Built customer-facing web application using React and Node.js, achieving 99.9% uptime",
            "Optimized database queries reducing API response time by 60%",
            "Collaborated with product team to define features based on user feedback and analytics"
          ]
        }
      ]
    },
    {
      "heading": "EDUCATION",
      "type": "education",
      "content": [
        {
          "institution": "University of Technology",
          "location": "Boston, MA",
          "degree": "B.S. in Computer Science",
          "dates": "2014 - 2018",
          "details": [
            "GPA: 3.8/4.0",
            "Dean's List all semesters",
            "Relevant Coursework: Data Structures, Algorithms, Database Systems, Software Engineering"
          ]
        }
      ]
    },
    {
      "heading": "SKILLS",
      "type": "skills",
      "content": [
        {
          "label": "Languages",
          "items": ["JavaScript", "TypeScript", "Python", "Java", "SQL"]
        },
        {
          "label": "Frameworks & Libraries",
          "items": ["React", "Node.js", "Express", "Django", "Spring Boot"]
        },
        {
          "label": "Tools & Technologies",
          "items": ["Docker", "Kubernetes", "AWS", "Git", "Jenkins", "PostgreSQL", "MongoDB"]
        },
        {
          "label": "Methodologies",
          "items": ["Agile/Scrum", "Test-Driven Development", "CI/CD", "Microservices"]
        }
      ]
    },
    {
      "heading": "PROJECTS",
      "type": "projects",
      "content": [
        {
          "name": "Open Source Contribution - React Table",
          "technologies": "TypeScript, React",
          "dates": "2023",
          "link": "github.com/tanstack/table",
          "bullets": [
            "Contributed pagination feature used by 50K+ developers",
            "Fixed critical accessibility issues improving WCAG compliance"
          ]
        },
        {
          "name": "Personal Finance Tracker",
          "technologies": "Python, Flask, PostgreSQL",
          "dates": "2022",
          "bullets": [
            "Developed full-stack application with budget tracking and data visualization",
            "Implemented secure authentication and data encryption"
          ]
        }
      ]
    },
    {
      "heading": "CERTIFICATIONS",
      "type": "certifications",
      "content": [
        {
          "name": "AWS Solutions Architect - Associate",
          "issuer": "Amazon Web Services",
          "date": "2022"
        },
        {
          "name": "Certified ScrumMaster (CSM)",
          "issuer": "Scrum Alliance",
          "date": "2021"
        }
      ]
    }
  ]
}</pre>
        </div>
    </div>

    <footer>
        <p>All processing happens locally in your browser. No data is sent to any server.</p>
    </footer>

    <script>
        // ========================================
        // Configuration
        // ========================================
        const CONFIG = {
            page: {
                width: 12240,
                height: 15840,
                margins: { top: 720, bottom: 720, left: 720, right: 720 }
            },
            fonts: { primary: "Calibri", fallback: "Arial" },
            sizes: { name: 40, sectionHeader: 28, body: 21, small: 20 },
            colors: { black: "000000", darkGray: "666666" },
            spacing: { afterParagraph: 80, afterSection: 0, sectionGap: 160, lineSpacing: 240 },
            bullets: { leftIndent: 288, hangingIndent: 288 },
            rightTabPosition: 10800
        };

        // ========================================
        // ResumeDocumentBuilder Class
        // ========================================
        class ResumeDocumentBuilder {
            constructor(resumeData) {
                this.data = resumeData;
                this.children = [];
            }

            createText(text, options = {}) {
                return new docx.TextRun({
                    text: text || "",
                    font: CONFIG.fonts.primary,
                    size: CONFIG.sizes.body,
                    color: CONFIG.colors.black,
                    ...options
                });
            }

            createParagraph(children, style = "Normal", options = {}) {
                return new docx.Paragraph({
                    style: style,
                    children: Array.isArray(children) ? children : [children],
                    ...options
                });
            }

            createSplitLine(leftText, rightText, style) {
                const children = [this.createText(leftText)];
                if (rightText) {
                    children.push(this.createText("\t"));
                    children.push(this.createText(rightText));
                }
                return this.createParagraph(children, style, {
                    tabStops: [{ type: docx.TabStopType.RIGHT, position: CONFIG.rightTabPosition }]
                });
            }

            createBullet(content) {
                const children = Array.isArray(content) ? content : [this.createText(content)];
                return this.createParagraph(children, undefined, {
                    numbering: { reference: "resume-bullets", level: 0 }
                });
            }

            addBullets(bullets) {
                if (bullets) bullets.forEach(b => this.children.push(this.createBullet(b)));
            }

            build() {
                this.addNameHeader();
                this.addContactLine();
                if (this.data.summary) {
                    this.addEmptyLine();
                    this.addSummarySection();
                }
                for (const section of this.data.sections) {
                    this.addEmptyLine();
                    this.addSection(section);
                }
                return new docx.Document({
                    styles: this.getStyles(),
                    numbering: this.getNumberingConfig(),
                    sections: [{
                        properties: {
                            page: {
                                size: { width: CONFIG.page.width, height: CONFIG.page.height },
                                margin: CONFIG.page.margins
                            }
                        },
                        children: this.children
                    }]
                });
            }

            getStyles() {
                return {
                    default: {
                        document: {
                            run: { font: CONFIG.fonts.primary, size: CONFIG.sizes.body, color: CONFIG.colors.black },
                            paragraph: { spacing: { after: CONFIG.spacing.afterParagraph, line: CONFIG.spacing.lineSpacing, lineRule: "auto" } }
                        }
                    },
                    paragraphStyles: [
                        { id: "Normal", name: "Normal", run: { font: CONFIG.fonts.primary, size: CONFIG.sizes.body }, paragraph: { spacing: { after: CONFIG.spacing.afterParagraph, line: CONFIG.spacing.lineSpacing } } },
                        { id: "Heading1", name: "Heading 1", basedOn: "Normal", next: "Normal", run: { font: CONFIG.fonts.primary, size: CONFIG.sizes.name, bold: true } },
                        { id: "Heading2", name: "Heading 2", basedOn: "Normal", next: "Normal", run: { font: CONFIG.fonts.primary, size: CONFIG.sizes.sectionHeader, bold: true } },
                        { id: "Employer", name: "Employer", basedOn: "Normal", run: { bold: true }, paragraph: { spacing: { after: 0 }, tabStops: [{ type: docx.TabStopType.RIGHT, position: CONFIG.rightTabPosition }] } },
                        { id: "JobRole", name: "Job Role", basedOn: "Normal", run: { italics: true }, paragraph: { spacing: { after: CONFIG.spacing.afterParagraph }, tabStops: [{ type: docx.TabStopType.RIGHT, position: CONFIG.rightTabPosition }] } }
                    ]
                };
            }

            getNumberingConfig() {
                return {
                    config: [{
                        reference: "resume-bullets",
                        levels: [{
                            level: 0,
                            format: docx.LevelFormat.BULLET,
                            text: "â€¢",
                            alignment: docx.AlignmentType.LEFT,
                            style: {
                                paragraph: { indent: { left: CONFIG.bullets.leftIndent, hanging: CONFIG.bullets.hangingIndent } },
                                run: { font: CONFIG.fonts.primary }
                            }
                        }]
                    }]
                };
            }

            addNameHeader() {
                this.children.push(this.createParagraph(
                    this.createText(this.data.name, { size: CONFIG.sizes.name, bold: true }),
                    "Heading1"
                ));
            }

            addContactLine() {
                this.children.push(this.createParagraph(
                    this.createText(this.data.contact.items.join(" | "))
                ));
            }

            addSummarySection() {
                this.children.push(this.createParagraph(this.createText(this.data.summary.heading || "PROFESSIONAL SUMMARY"), "Heading2"));
                this.children.push(this.createParagraph(this.createText(this.data.summary.text)));
            }

            addEmptyLine() {
                this.children.push(this.createParagraph([]));
            }

            addSection(section) {
                this.children.push(this.createParagraph(this.createText(section.heading), "Heading2"));
                switch (section.type) {
                    case "skills": this.addSkillsContent(section.content); break;
                    case "experience": this.addExperienceContent(section.content); break;
                    case "education": this.addEducationContent(section.content); break;
                    case "certifications": this.addCertificationsContent(section.content); break;
                    case "projects": this.addProjectsContent(section.content); break;
                }
            }

            addSkillsContent(skillGroups) {
                for (const group of skillGroups) {
                    this.children.push(this.createParagraph([
                        this.createText(`${group.label}: `, { bold: true }),
                        this.createText(group.items.join(", "))
                    ]));
                }
            }

            addExperienceContent(experiences) {
                for (const exp of experiences) {
                    this.children.push(this.createSplitLine(exp.company, exp.dates, "Employer"));
                    this.children.push(this.createSplitLine(exp.title, exp.location, "JobRole"));
                    this.addBullets(exp.bullets);
                }
            }

            addEducationContent(educationEntries) {
                for (const edu of educationEntries) {
                    this.children.push(this.createSplitLine(edu.institution, edu.location, "Employer"));
                    this.children.push(this.createSplitLine(edu.degree, edu.dates, "JobRole"));
                    this.addBullets(edu.details);
                }
            }

            addCertificationsContent(certs) {
                for (const cert of certs) {
                    this.children.push(this.createBullet([
                        this.createText(cert.name, { bold: true }),
                        this.createText(cert.issuer ? ` â€“ ${cert.issuer}` : ""),
                        this.createText(cert.date ? ` (${cert.date})` : "")
                    ]));
                }
            }

            addProjectsContent(projects) {
                for (const project of projects) {
                    const nameText = project.name + (project.technologies ? ` | ${project.technologies}` : "");
                    this.children.push(this.createSplitLine(nameText, project.dates, "Employer"));

                    if (project.link) {
                        this.children.push(this.createParagraph(
                            this.createText(project.link, { color: "0563C1" })
                        ));
                    }
                    this.addBullets(project.bullets);
                }
            }
        }

        // ========================================
        // UI Functionality
        // ========================================

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;

                // Update active tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Update active content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${targetTab}-content`).classList.add('active');
            });
        });

        // Example toggle
        document.getElementById('exampleToggle').addEventListener('click', (e) => {
            e.preventDefault();
            const content = document.getElementById('exampleContent');
            const toggle = document.getElementById('exampleToggle');

            if (content.classList.contains('show')) {
                content.classList.remove('show');
                toggle.textContent = 'ðŸ“‹ Show Example JSON';
            } else {
                content.classList.add('show');
                toggle.textContent = 'ðŸ“‹ Hide Example JSON';
            }
        });

        // Copy example
        document.getElementById('copyExample').addEventListener('click', () => {
            const exampleText = document.getElementById('exampleJson').textContent;
            navigator.clipboard.writeText(exampleText).then(() => {
                const btn = document.getElementById('copyExample');
                const originalText = btn.textContent;
                btn.textContent = 'âœ“ Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        });

        // Use example
        document.getElementById('useExample').addEventListener('click', () => {
            const exampleText = document.getElementById('exampleJson').textContent;
            document.getElementById('jsonText').value = exampleText;

            // Switch to paste tab
            document.querySelector('.tab[data-tab="paste"]').click();

            showStatus('Example loaded! Click "Generate Resume" to create the DOCX.', 'success');
        });

        // ========================================
        // Resume Generation
        // ========================================

        function validateResumeData(data) {
            if (!data.name) {
                throw new Error('Missing required field: name');
            }
            if (!data.contact || !data.contact.items) {
                throw new Error('Missing required field: contact.items');
            }
            if (!data.sections || !Array.isArray(data.sections)) {
                throw new Error('Missing or invalid sections array');
            }
            return true;
        }

        async function generateResume(data) {
            try {
                // Validate data
                validateResumeData(data);

                // Check if docx library is loaded
                if (typeof docx === 'undefined') {
                    throw new Error('Document library not loaded. Please check your internet connection and refresh the page.');
                }

                // Build document
                const builder = new ResumeDocumentBuilder(data);
                const doc = builder.build();

                // Generate blob
                const blob = await docx.Packer.toBlob(doc);

                // Download
                downloadBlob(blob, 'resume.docx');

                showStatus('Resume generated successfully! Download started.', 'success');
            } catch (error) {
                console.error('Generation error:', error);

                if (error instanceof SyntaxError) {
                    showStatus('Invalid JSON format. Please check your input and try again.', 'error');
                } else {
                    showStatus('Error: ' + error.message, 'error');
                }
            }
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();

            // Cleanup
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = type;
        }

        function setButtonLoading(buttonId, isLoading) {
            const btn = document.getElementById(buttonId);
            if (isLoading) {
                btn.disabled = true;
                btn.dataset.originalText = btn.textContent;
                btn.innerHTML = 'Generating<span class="loading"></span>';
            } else {
                btn.disabled = false;
                btn.textContent = btn.dataset.originalText || 'Generate Resume';
            }
        }

        // ========================================
        // Event Handlers
        // ========================================

        // Generate from file upload
        document.getElementById('generateFromFile').addEventListener('click', async () => {
            const fileInput = document.getElementById('jsonFile');
            const file = fileInput.files[0];

            if (!file) {
                showStatus('Please select a JSON file first.', 'error');
                return;
            }

            setButtonLoading('generateFromFile', true);

            try {
                const text = await file.text();
                const data = JSON.parse(text);
                await generateResume(data);
            } catch (error) {
                if (error instanceof SyntaxError) {
                    showStatus('Invalid JSON file. Please check the file format.', 'error');
                } else {
                    showStatus('Error reading file: ' + error.message, 'error');
                }
            } finally {
                setButtonLoading('generateFromFile', false);
            }
        });

        // Generate from pasted text
        document.getElementById('generateFromText').addEventListener('click', async () => {
            const textarea = document.getElementById('jsonText');
            const jsonText = textarea.value.trim();

            if (!jsonText) {
                showStatus('Please paste JSON data first.', 'error');
                return;
            }

            setButtonLoading('generateFromText', true);

            try {
                const data = JSON.parse(jsonText);
                await generateResume(data);
            } catch (error) {
                if (error instanceof SyntaxError) {
                    showStatus('Invalid JSON format. Please check your input.', 'error');
                } else {
                    showStatus('Error: ' + error.message, 'error');
                }
            } finally {
                setButtonLoading('generateFromText', false);
            }
        });

        // Keyboard shortcut: Ctrl/Cmd + Enter to generate
        document.getElementById('jsonText').addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('generateFromText').click();
            }
        });

        // Check if docx library loaded successfully
        window.addEventListener('load', () => {
            if (typeof docx === 'undefined') {
                showStatus('Warning: Document library failed to load. Please check your internet connection and refresh the page.', 'error');
            }
        });
    </script>
</body>
</html>
